# Estado del Proyecto - 18 Feb 2026

## üìä Resumen Ejecutivo

**Versi√≥n actual**: v0.10.9
**Branch**: master (+10 commits ahead of origin)
**Tests**: 2,907 passed, 24 skipped, 10 xfailed, 6 xpassed
**√öltimo sprint completado**: S18 (Advanced Search + Filters complete)

---

## ‚úÖ Sprints Completados (0-18)

### Sprint 0-6: Fundaci√≥n (Completado 2026-02-06)
- ‚úÖ S0: Quick wins - 15 xfail cleanup
- ‚úÖ S1: PlanTL RoBERTa NER, multi-model voting, gazetteer
- ‚úÖ S2: Pro-drop gender inference, saliency scoring
- ‚úÖ S3: Anachronism detection, temporal patterns
- ‚úÖ S4: Character profiling (6 indicators), network analysis, OOC
- ‚úÖ S5: Qwen 2.5, prompt engineering (CoT), anti-injection
- ‚úÖ S6: API endpoints (network, timeline, profiles), focus mode

### Sprint 7-8: Licensing + Pipeline (Completado 2026-02-10)
- ‚úÖ S7a: Licensing migration
- ‚úÖ S7b: Feature gating + integration
- ‚úÖ S7c: Pipeline fixes
- ‚úÖ S7d: UX + Copy
- ‚úÖ S8a: Pipeline enrichment + persistencia
- ‚úÖ S8b: Tab badges + empty states
- ‚úÖ S8c: Invalidaci√≥n granular + datos stale

### Sprint 15: Grammar Fixes (Completado)
- ‚úÖ Art√≠culos 'a' t√≥nica (24 sustantivos: agua, alma, arma...)
- ‚úÖ Concordancia contextual con `_is_subject_modifier()`
- ‚úÖ Alert ordering por severity > confidence > position

### Sprint 16: Collections + Thesaurus (Completado 2026-02-18)
- ‚úÖ **Collections Frontend** (15 archivos, +2,366 LOC)
  - CRUD completo de colecciones
  - Entity link management (auto-suggestions + manual)
  - Cross-book inconsistency analysis
  - 3-tab UI: Libros, Entity Links, An√°lisis Cross-Book
- ‚úÖ **Thesaurus WordNet OMW 1.4** (5 archivos, +366 LOC)
  - Auto-build script con descarga NLTK bajo demanda
  - ~38,500 synsets espa√±oles
  - Integraci√≥n con RepetitionDetector
  - Frontend synonym chips en DetailPanel
- ‚úÖ **Cleanup + Maintenance**
  - `docs/MAINTENANCE.md` creado
  - 4 test fixes (imports, numpy bool, mocks, skip markers)
  - Temp files removed
  - Build + test verification (2,907 tests OK)

### Sprint 17-18: Wire-ups + Advanced Filters (Completado 2026-02-18)

#### S17: Wire-ups (Completado)
- ‚úÖ **HomeView** ‚Üí Router `/` + MenuBar "Inicio"
- ‚úÖ **LicenseDialog** ‚Üí `SettingsView.vue` secci√≥n "Licencia"
- ‚úÖ **VersionHistory + Sparkline** ‚Üí `ResumenTab.vue` (stat-card + full card)
- ‚úÖ **SuppressionRulesDialog** ‚Üí `AlertsDashboard.vue` toolbar button (pi-filter-slash)

#### S18: Advanced Search + Filters (Completado)
- ‚úÖ **Alert Type filter** (`useAlertUtils.ts`, `useAlertFiltering.ts`)
  - ALERT_TYPE_LABELS con 15 tipos (linguistic_filler, overused_word, lexical_close, etc.)
  - MultiSelect UI en AlertsDashboard
- ‚úÖ **Entity filter** (`useAlertFiltering.ts`, `AlertsDashboard.vue`)
  - Filtrar alertas por entidad espec√≠fica (entityIds match)
  - MultiSelect UI con entity options
- ‚úÖ **Filter persistence + presets** (`useAlertFiltering.ts`)
  - localStorage con schema version (alert_filters_v1)
  - 4 presets: "Errores gramaticales", "Severidad alta+", "Inconsistencias", "Estilo"
  - Select UI "Filtros r√°pidos" en toolbar

---

## üîß Estado T√©cnico Actual

### Backend (Python 3.12.3)
- **NLP**: spaCy es_core_news_lg, sentence-transformers
- **LLM**: Ollama (llama3.2, qwen2.5, mistral)
- **DB**: SQLite con WAL mode
- **Thesaurus**: WordNet OMW 1.4 (~38K synsets)
- **Tests**: 2,907 passing (pytest)

### Frontend (Vue 3)
- **UI**: PrimeVue, Vite, TypeScript
- **Build**: ‚úÖ Passing (no errors)
- **Stores**: Pinia (projects, collections, analysis, entities, etc.)
- **Routes**: Projects, Collections, Settings, Revision, Alerts, Characters

### Arquitectura
- **Result pattern** en operaciones fallibles
- **API types ‚Üí transformers ‚Üí domain types** (snake_case ‚Üí camelCase)
- **Thread-safe singletons** con double-checked locking
- **Multi-model voting** para NER y correferencias
- **6-phase pipeline**: Parse ‚Üí Extract ‚Üí Resolve ‚Üí Deep Analysis ‚Üí Quality ‚Üí Persistence

---

## üìù Features Diferidas (documentado en MAINTENANCE.md)

### 1. Eventos Contradictorios Cross-Book (~59h, Fase 3)
**Qu√© es**: Detectar cuando un evento en Libro A contradice Libro B (ej: personaje muere en L2 pero aparece vivo en L3)

**Infraestructura existente**:
- `analysis/event_types.py` - Taxonom√≠a 45+ eventos
- `analysis/event_detection.py` - NLP detection Tier 1
- `analysis/event_detection_llm.py` - LLM detection
- `analysis/event_continuity.py` - Intra-book continuity
- `llm/prompts.py` - NoT prompts

**Por implementar** (59h total):
| Fase | Componente | Horas | Riesgo |
|------|-----------|-------|--------|
| 3a | Event persistence (tabla SQLite) | 8h | Medio |
| 3b | Cross-book matcher | 12h | Medio |
| 3c | LLM contradiction detector | 16h | ALTO |
| 3d | API + frontend | 11h | Bajo |
| 3e | Temporal cross-reference | 12h | Medio |

**Riesgos**: Falsos positivos altos sin fine-tuning, requiere LLM ‚â•7B params

### 2. Wire-ups Pendientes (componentes ya implementados)
| Feature | Component(s) | Donde | Esfuerzo |
|---------|-------------|-------|----------|
| VersionHistory | `VersionHistory.vue`, `VersionComparison.vue`, `VersionSparkline.vue` | `RevisionView.vue` tab | 2h |
| LicenseDialog | `LicenseDialog.vue` (822 LOC) | `SettingsView.vue` secci√≥n | 1h |
| HomeView | `HomeView.vue` (434 LOC) | Router: `/` component | 0.5h |
| Suppression Rules | Backend: 3 endpoints | `SettingsView` o `AlertsDashboard` | 3h |

**Total wire-ups**: 6.5h

### 3. Mejoras de Componentes (baja prioridad)
- `CharacterView.vue` ‚Üí migrar a `useEntityCrud`
- `CharacterSheet.vue` ‚Üí usar `useEntityUtils` para `ATTRIBUTE_LABELS`

---

## üéØ Pr√≥ximos Sprints Sugeridos

### Opci√≥n A: Quick Wins (Wire-ups)
**Duraci√≥n**: 1-2 d√≠as
**Esfuerzo**: 6.5h
**ROI**: Alto - features ya implementadas, solo falta conectar

1. VersionHistory en RevisionView (2h)
2. LicenseDialog en SettingsView (1h)
3. HomeView en router (0.5h)
4. Suppression Rules UI (3h)

**Resultado**: 4 features funcionales sin escribir c√≥digo nuevo

### Opci√≥n B: Eventos Contradictorios (Fase 3a-3b)
**Duraci√≥n**: 1 semana
**Esfuerzo**: 20h (solo persistencia + matcher, sin LLM)
**ROI**: Medio - funcional pero limitado sin LLM

1. Event persistence layer (8h)
2. Cross-book event matcher (12h)

**Diferir a futuro**: LLM contradiction detector (16h) + temporal analysis (12h)

### Opci√≥n C: Auditor√≠a y Optimizaci√≥n
**Duraci√≥n**: 3-5 d√≠as
**Esfuerzo**: Variable
**ROI**: Alto - mejora calidad general

1. Performance audit (cuellos de botella)
2. Memory profiling (NLP models, spaCy cache)
3. Test coverage gaps
4. Code quality (dead code, duplicates)
5. Security audit (input validation, SQL injection)

### Opci√≥n D: Frontend Polish
**Duraci√≥n**: 1 semana
**Esfuerzo**: ~40h
**ROI**: Alto - UX/accesibilidad

1. Accessibility audit (WCAG 2.1 AA)
2. Responsive design (mobile/tablet)
3. Keyboard navigation
4. Loading states + error boundaries
5. Toast notifications unificadas
6. Dark mode (si no est√°)

### Opci√≥n E: Documentation Sprint
**Duraci√≥n**: 2-3 d√≠as
**Esfuerzo**: ~20h
**ROI**: Medio - importante para onboarding

1. User manual (ES + EN)
2. API documentation (Swagger/OpenAPI)
3. Architecture decision records (ADR)
4. Tutorial videos storyboard
5. FAQ from beta testers

---

## üêõ Bugs Conocidos y Deuda T√©cnica

### Alta Prioridad
- Ninguno conocido actualmente

### Media Prioridad
- `test_entity_validation.py`: API `validate_entity()` no implementada (12 tests skipped)
- Scope resolver: 10 xfails en casos adversariales (ling√º√≠stica compleja)

### Baja Prioridad
- 4 parser tests skipped (archivos de prueba no encontrados)
- `test_speech_db_cache.py`: 1 skip (migraci√≥n DB pendiente)
- 7 mention validation tests skipped (requieren spaCy, slow)

---

## üì¶ Dependencias a Revisar

### NLP (cada 6 meses)
- [ ] spaCy es_core_news_lg - verificar nuevas versiones
- [ ] sentence-transformers - modelos m√°s precisos/ligeros
- [ ] WordNet OMW - revisar si hay 1.5+ en omwn.org
- [ ] Ollama - nuevos modelos con mejor espa√±ol

### Frontend (cada 3 meses)
- [ ] Vue 3 - major/minor updates
- [ ] PrimeVue - breaking changes
- [ ] Vite - performance improvements
- [ ] TypeScript - compatibilidad

### Backend (cada 3 meses)
- [ ] FastAPI - nuevas features
- [ ] Pydantic - verificar v3
- [ ] SQLite - WAL mode optimizations
- [ ] Python 3.12+ - minor versions

### Seguridad
- [ ] `pip audit` - vulnerabilidades backend
- [ ] `npm audit` - vulnerabilidades frontend
- [ ] CVEs en dependencias directas

---

## üíæ Commits Pendientes de Push

10 commits ahead of origin/master:
```
d151edc fix(tests): correct LLM mock path in register test
8b2b493 fix(tests): skip entity_validation tests pending API
2872c05 fix(tests): use equality check for numpy boolean
445b82d fix(tests): correct entity_validation import path
091a055 feat(nlp): enhance scope resolver with adversarial grammar
b77bbba chore: add maintenance guide, fix import, remove dead files
1fb7be2 feat(thesaurus): integrate WordNet OMW 1.4 synonyms
10567a0 feat(collections): add cross-book collections frontend
cd93706 refactor(frontend): integrate composables
d7a8e20 refactor(frontend): extract composables and fix types
```

**Acci√≥n requerida**: `git push` para sincronizar con origin

---

## üìà M√©tricas del Proyecto

### C√≥digo
- **Backend**: ~50K LOC Python
- **Frontend**: ~35K LOC TypeScript/Vue
- **Tests**: 2,907 tests (light), ~500 heavy tests
- **Coverage**: ~75% estimado (no medido exactamente)

### Performance
- **An√°lisis documento 50K palabras**: ~2-3 min (CPU)
- **spaCy model load**: ~2s (cached)
- **LLM query (Ollama)**: ~1-3s por prompt
- **Frontend build**: ~23s

### Calidad
- **Tests passing**: 98.7% (2,907/2,947)
- **Linter**: Black + isort + mypy
- **Type coverage**: ~85% (type hints obligatorios)

---

## üéì Aprendizajes del Sprint S16

1. **Auto-build pattern funciona muy bien**: NLTK descarga una vez, offline despu√©s
2. **Collections backend robusto**: 11 endpoints ya listos, solo faltaba UI
3. **Test fixes revelaron deuda t√©cnica oculta**: imports incorrectos, mocks mal configurados
4. **Thesaurus WordNet es suficiente**: No necesitamos Wiktionary parsing a√∫n
5. **MAINTENANCE.md es clave**: Checklist previene dependency rot

---

## üîÆ Pr√≥ximas Decisiones

1. **¬øPriorizar wire-ups (quick wins) o features nuevas?**
2. **¬øVersion bump a 0.11.0 o mantener 0.10.x?** (seg√∫n user prefs: solo 0.x.Y sin preguntar)
3. **¬øEjecutar auditor√≠a comprehensiva o continuar con sprints funcionales?**
4. **¬øDocumentaci√≥n de usuario o seguir con backend/frontend?**
5. **¬øPush a origin o esperar m√°s commits?**
